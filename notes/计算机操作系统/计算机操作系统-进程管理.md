# 进程与线程

## 1. 进程

进程是资源分配的基本单位

进程控制块（Process Control Block，PCB）描述进程的基本信息和运行状态，所谓的创建进程和撤销进程，都是指PCB的操作。

下图显示了4个程序创建了4个进程，这四个进程可以并发执行。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/a6ac2b08-3861-4e85-baa8-382287bfee9f.png"/> </div><br>

## 2. 线程

线程是独立调度的基本单位

一个进程中可以有多个线程，它们共享进程资源。

QQ和浏览器是两个进程，浏览器进程里面有很多线程，例如HTTP请求线程、时间响应线程、渲染线程等等，线程的并发执行使得在浏览器中点击一个新链接从而发起HTTP请求时，浏览器还可以响应用户的其他事件。

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/3cd630ea-017c-488d-ad1d-732b4efeddf5.png"/> </div><br>

## 3. 区别

Ⅰ 拥有资源

进程是**资源分配**的基本单位，但是线程不拥有资源，线程可以访问隶属进程的资源

Ⅱ 调度

线程是**独立调度**的基本单位，在同一进程中，线程切换不会引起进程切换，从一个进程中的线程切换到另一个进程中的线程时，会引起进程的切换。

Ⅲ 系统开销

由于创建或者撤销进程时，系统都要为之分配货回收资源，如内存空间、I/O设备等，所付出的开销远大于创建或者撤销线程时的开销，类似地，在进程切换时，设计当前执行进程CPU环境的保存及新调度的进程CPU环境，而线程切换时只要保存和设置少量的寄存器内容，开销很小。

Ⅳ 通信方面

线程间可以通过直接读写同一进程中的数据进行通信，但是进程通信需要借助IPC

# 进程状态的切换

<div align="center"> <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ProcessState.png" width="500"/> </div><br>

<div align="center"> <img src="http://test-fangsong-imgsubmit.oss-cn-beijing.aliyuncs.com/img/image-20201102000402728.png" width="500"/> </div><br>

* 就绪状态（read）：等待被调度
* 运行状态（running）
* 阻塞状态（waiting）：等待资源

应该注意以下内容：

* 只有就绪态和运行态是可以想互转的，其他都是单项转换。就绪态的进程通过调度算法从而获得CPU时间，转化为运行状态；而运行状态的进程，在分配给他饿得CPU时间片用完之后就会转化为就绪状态，等待下一次调度。
* 阻塞状态是缺少需要的资源从而从运行状态转化而来。但是该资源不包括CPU时间，缺少CPU时间从而运行态度转换为就绪态。

# 进程调度算法

不同环境的调度算法目标不同，因此需要针对不同环境来讨论调度算法。

## 1. 批处理系统

批处理系统没有太多的用户操作，在该系统中，调度算法目标是保证吞吐量和周转时间（从提交到终止的时间）

### 1.1 先来先服务 first-come first-second（FCFS）

非抢占式的调度算法，按照请求的顺序进行调度。

有利于长作业，但不利于短作业，因为短作业必须一直等待前面的长作业执行完毕才能执行，而长作业又需要执行很长时间，造成了短作业等待时间过长。

### 1.2 短作业优先 shortest job first (SJF)

非抢占式的调度算法，按估计运行时间最短的顺序进行调度。

长作业有可能会饿死，处于一直等待段作业执行完毕的状态。因为如果一直有短作业到来，那么长作业永远不会得到调度。

### 1.3 最短剩余时间优先shortest remaining time next（SRTN）

最短作业优先的抢占式版本，按剩余运行时间的顺序调度。当一个新的作业到达时，其整个运行时间与当前进程的剩余时间作对比。如果新的进程需要的时间更少，则挂起当前进程，运行新的进程。否则新的进程等待。

